/*! violette 05-02-2015 */
var Utils=function(a,b){"use strict";function c(b,c){var d=null;if(!c.is("textarea")){var e=null!=b.content?b.content:c.text();d=a.trim(e),c.is("div")&&(d=d.replace(/(<([^>]+)>)/gi,"").replace(/ +(?= )/g,"").replace(/^ +/gm,""))}return d}function d(a){var b,c=a.split(/\r\n|\r|\n/),d=0,e=!1,f=!1;if(c.forEach(function(a,c){var g,h=!1;for(g=0;g<a.length;g++){var i=a[g];if(e)"/"===i&&"*"===a[g-1]&&(e=!1);else if(f)h=!0,i===b?f=!1:"\\"===i&&g++;else if(" "!==i&&"	"!==i)if('"'===i||"'"===i)h=!0,f=!0,b=i;else if("/"===i){if("*"!==a[g+1]){if("/"===a[g+1])break;if(h=!0,-1!==a.indexOf("/*",g+1))throw"Potential block comment start following potential regular expression on same line"+c;if(-1!==a.indexOf('"',g+1)||-1!==a.indexOf("'",g+1)){var j=a.trim();if("\\"===j[j.length-1])throw"Potential multi-line string literal following potential regular expression on same line"+c}break}e=!0,g++}else if(h=!0,"*"===i&&"/"===a[g+1])throw"Unexpected */ when not in a block comment"+c}if(h&&d++,f&&"\\"!==a[a.length-1])throw"Unclosed string at end of line"+c}),e)throw"Unclosed block comment at end of file";if(f)throw"Unclosed string at end of file";return{total:c.length,sloc:d}}function e(a,b){return a+f(b-a)}function f(a){return Math.floor(Math.random()*a)}function g(a){return a+"-"+e(1,1e4)}function h(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}return b.createLocation=function(a,b,c){if(!(0>b||b>c)){if(!a)return{from:{line:-1,col:-1,offset:b},to:{line:-1,col:-1,offset:c}};var d=a.length;c=Math.min(c,d),b=Math.min(b,c);for(var e,f=0,g=0,h=0,i=0;d>=i;i++){if(i==b&&(e={line:f,col:i-g,offset:i}),i==c){var j={line:f,col:i-g,offset:i};return{from:e,to:j}}var k=a.charAt(i);"\n"==k?(g=i+1,"\r"!==h&&f++):"\r"==k&&(f++,g=i+1),h=k}}return{from:{line:-1,col:-1,offset:b},to:{line:-1,col:-1,offset:c}}},b.selectionOffsets=function(a,c,d){for(var e,f=a.getCursor("from"),g=c.split("\n"),h=f.line,i=0,j=0;j<g.length;j++){if(h==j){var k=i+f.line+f.ch,l=k+d.length;e=b.createLocation(c,k,l),console.log(k+" - "+l);break}i+=g[j].length}var m=0,n=0;return e&&(m=e.from.offset,n=e.to.offset),{start:m,end:n}},b.createCode=function(a,b,c,d,e,f,g,h,i,j){d=d||[],e=e||[],f=f||[],g=g||[],h=h||0,i=i||[],j=j||"";var k=document.location.href,l=Date.now();return b=b||"Java: *scratched* code snippet",{name:a,description:b,content:c,elapsedtime:j,tags:d,datastructures:e,algorithms:f,refactorings:g,confidence:h,comments:i,url:k,birthday:l}},b.brand=g,b.debounce=h,b.count=d,b.getContent=c,b}(window.jQuery,Utils||{}),Matcher=function(a,b){"use strict";function c(a,b){var c=[];return a.replace(b,function(){if(arguments&&arguments.length>0)for(var b=0;b<arguments.length;b++){var d=arguments[b];a===d&&c.push(d)}}),c.length>0}function d(a){var b=/(\/\*[\w'\s\r\n\*]*\*\/)|(\/\/[\w\s']*)/gm;return c(a,b)}function e(a){var b=/import[^;=\n]*\s[\S\s]*?(?=;)/;return c(a,b)}function f(a){var b=/class[^;=\n]*\s[\S\s]*?(?={)/;return c(a,b)}function g(a){var b=/^\s*?(((public|private|protected|static|final|native|synchronized|abstract|threadsafe|transient)\s+?)*)\s*?(\w+?)\s+?(\w+?)\s*?\(([^)]*)\)[\w\s,]*?(?={)?\s*?/;return c(a,b)}function h(a,b){var c=/class[^;=\n]*\s[\S\s]*?(?={)/g,d=[];a.replace(c,function(){var a=arguments[0];a&&a.length>0&&d.push(a.replace("\n"," ").split(" ")[1])});var e=d[0];return e?e:b}return b.matches=c,b.isComment=d,b.isMethod=g,b.matchClassName=h,b.isImport=e,b.isClass=f,b}(window.jQuery,Matcher||{}),Html=function(a,b){"use strict";function c(a,c,d){var f=b.buildHtml("div",{"class":"info"},{});return c=e(a,c,f,d)}function d(a,c,d){var f=b.buildHtml("span",{"class":"tabnav-right"},{});return c=e(a,c,f,d)}function e(a,c,d,e){for(var f=e.length,g=0;f>g;g++){var h=(b.buildHtml("div",{"class":"btn-group"},{}),e[g]),i=h.name,j=h.title,k=h.icon,l=h.callback,m='<span class="'+k+'"></span>',n=a.namespace+"-"+i,o=b.buildHtml("button",m,{type:"button",title:j,"data-provider":a.namespace,"data-handler":n});o.tooltipster({position:"right",theme:"tooltip-custom-theme"}),a.handler.push(n),a.callback.push(l),d.append(o)}return c.append(d),c}function f(){return b.buildHtml("span",{"class":"meta-divider"},{})}function g(a){return b.buildHtml("span"," "+a+" ",{"class":"extra"})}function h(a,c){a.status=b.buildHtml("span","NOT SAVED ",{"class":"status"});var d=a.content.replace(/\r\n|\r/g,"\n"),e=Utils.count(d),h=e.total+" lines ("+e.sloc+" sloc)";return a.sloc=g(h),c.append(a.status),c.append(f()),c.append(a.sloc),c}function i(a,c,d,e,f){var g="delete"==a;return b.buildHtml("button",f,{type:"button","class":g?"violette-button octicon-button danger btn-dark-link":"violette-button octicon-button btn-dark-link",title:c,"data-provider":d.namespace,"data-handler":e})}function j(a,c,d,e){return b.buildHtml("button",e,{type:"button","class":"violette-button minibutton",title:a,"data-provider":c.namespace,"data-handler":d})}function k(a){return Html.buildHtml("button",'<span class="octicon octicon-x" aria-hidden="true"></span>',{"class":"close","aria-label":"Close","data-provider":a.namespace,"data-handler":a.namespace+"-close"})}function l(a,c){var d=b.buildHtml("span",{"class":"tabnav-right"},{}),e=b.buildHtml("div",{"class":"info"},{});e=h(a,e),c.append(e);for(var f=a.options.actions,g=f.length,k=!1,l=b.buildHtml("div",{"class":"button-group"},{}),m=0;g>m;m++){var n=f[m],o=n.name,p=n.title,q=n.icon,r=n.callback,s="undefined"!=typeof n.label,t=s?n.label:'<span class="'+q+'"></span>',u=a.namespace+"-"+o,v=s?j(p,a,u,t):i(o,p,a,u,t);v.tooltipster({position:"bottom",theme:"tooltip-custom-theme"}),a.handler.push(u),a.callback.push(r),s?(l.append(v),k=!0):"plus"===o?e.append(v):d.append(v)}return k&&d.append(l),c.append(d),c.append(e),c}function m(a,c){return null!=a.content&&(c=b.buildHtml("textarea",a.content,{"class":"file-editor-textarea violette-input"})),a.textarea=c,c}return b.buildHtml=function(b,c,d){"string"!=typeof c&&(d=c,c=null);var e="<"+b;for(var f in d)if(d.hasOwnProperty(f)){if(d[f]===!1)continue;e+=" "+f+'="'+d[f]+'"'}return e+=c?">"+c+"</"+b+">":"/>",a(e)},b.buildHeader=function(a){var c=b.buildHtml("div",{"class":"violette-header  btn-toolbar"},{});return c=l(a,c)},b.buildFooter=function(a){var e=b.buildHtml("div",{"class":"violette-footer"},{}),f=b.buildHtml("div",{"class":"btn-toolbar"},{});return f=c(a,f,a.options.modes),f=d(a,f,a.options.social),a.staging=b.buildHtml("div",{"class":"violette-multistage btn-toolbar"},{}),e.append(a.staging),e.append(f),a.staging.hide(),e},b.buildBody=function(a,c){var d=b.buildHtml("div",{id:Utils.brand("editing"),"class":"editing"},{});return d.append(m(a,c)),d},b.buildClosingButton=k,b}(window.jQuery,Html||{}),Stopwatch=function(){"use strict";function a(a,b){this.startTime=0,this.stopTime=0,this.totalElapsed=0,this.started=!1,this.listener=void 0!=a?a:null,this.tickResolution=void 0!=b?b:500,this.tickInterval=null,this.onehour=36e5,this.onemin=6e4,this.onesec=1e3,this.start()}return a.prototype.start=function(){var a=function(a,b){return function(){return b.call(a)}};this.started||(this.startTime=(new Date).getTime(),this.stopTime=0,this.started=!0,this.tickInterval=setInterval(a(this,this.onTick),this.tickResolution))},a.prototype.stop=function(){return this.started&&(this.stopTime=(new Date).getTime(),this.started=!1,this.totalElapsed+=this.stopTime-this.startTime,null!=this.tickInterval&&clearInterval(this.tickInterval)),this.getElapsed()},a.prototype.reset=function(){this.totalElapsed=0,this.startTime=(new Date).getTime(),this.stopTime=this.startTime},a.prototype.restart=function(){this.stop(),this.reset(),this.start()},a.prototype.getElapsed=function(){var a=0;this.started&&(a=(new Date).getTime()-this.startTime),a+=this.totalElapsed;var b=parseInt(a/this.onehour);a%=this.onehour;var c=parseInt(a/this.onemin);a%=this.onemin;var d=parseInt(a/this.onesec),e=a%this.onesec;return{hours:b,minutes:c,seconds:d,milliseconds:e}},a.prototype.toString=function(){var a=function(a,b){for(a=a.toString();a.length<b;)a="0"+a;return a},b=this.getElapsed();return a(b.hours,2)+":"+a(b.minutes,2)+":"+a(b.seconds,2)},a.prototype.setListener=function(a){this.listener=a},a.prototype.onTick=function(){null!=this.listener&&this.listener(this)},a}(),Calls=function(a,b){"use strict";function c(b,c,d,e,f,g){a.ajax({type:b,headers:e,url:c,async:!0,data:JSON.stringify(d),dataType:f,success:function(a){var b={draft:a.draft,info:a.info,stages:a.stages,stage:a.stage,warnings:a.warnings,failure:a.failure};g&&g(b)},error:function(a,b,c){var d={failure:{message:a.responseText||c}};g&&g(d)}})}function d(a,b,d){var e={"Content-Type":"text/plain; charset=UTF-8","x-auth-token":"legolas"};c("GET",a,null,b||e,"text",d)}function e(a,b,d,e){var f={"Content-Type":"application/json; charset=UTF-8","x-auth-token":"legolas"};c("POST",a,b,d||f,"json",e)}function f(a,b,d,e){var f={"Content-Type":"application/json; charset=UTF-8","x-auth-token":"legolas"};c("PUT",a,b,d||f,"json",e)}return b.ACTIVE=!0,b.STAGING="http://www.cookandstuff.com/kiwi/",b.PRODUCTION="http://www.vesperin.com/kiwi/",b.CURRENT_HOST=b.ACTIVE?b.PRODUCTION:b.STAGING,b.CURATORS="&q=roles:curators",b.SERVICE_POST_URL=b.CURRENT_HOST+"eval?auth_token=legolas",b.SERVICE_GET_URL=b.CURRENT_HOST+"find?"+b.CURATORS,b.fetch=c,b.get=d,b.post=e,b.put=f,b}(window.jQuery,Calls||{}),Refactoring=function(a){"use strict";var b=Calls.SERVICE_POST_URL,c=Calls.SERVICE_GET_URL;return a.deleteSelection=function(a,c,d,e,f){var g=d.start,h=d.end,i=Utils.createCode(a,"Java: *scratched* code snippet",c),j={remove:{what:"region",where:[g,h],source:i,preprocess:e}};Calls.post(b,j,null,f)},a.detectMissingImports=function(a,c,d){var e=Utils.createCode(a,"Java: *scratched* code snippet",c),f={inspect:{source:e,imports:!0}};Calls.post(b,f,null,d)},a.inspectWholeSourcecode=function(a,c,d){var e=Utils.createCode(a,"Java: *scratched* code snippet",c),f={inspect:{source:e,imports:!1}};Calls.post(b,f,null,d)},a.renameSelectedMember=function(a,c,d,e,f,g){var h=e.start,i=e.end,j=Utils.createCode(a,"Java: *scratched* code snippet",d),k={rename:{what:"member",to:c,where:[h,i],source:j,preprocess:f}};Calls.post(b,k,null,g)},a.clipSelectedBlock=function(a,c,d,e,f){var g=d.start,h=d.end,i=Utils.createCode(a,"Java: *scratched* code snippet",c),j={slice:{source:i,where:[g,h],preprocess:e}};Calls.post(b,j,null,f)},a.deduplicate=function(a,c,d,e){var f=Utils.createCode(a,"Java: *scratched* code snippet",c),g={deduplicate:{source:f,preprocess:d}};Calls.post(b,g,null,e)},a.fullCleanup=function(a,c,d,e){var f=Utils.createCode(a,"Java: *scratched* code snippet",c),g={cleanup:{source:f,preprocess:d}};Calls.post(b,g,null,e)},a.optimize=function(a,c,d){var e=Utils.createCode(a,"Java: *scratched* code snippet",c),f={optimize:{source:e}};Calls.post(b,f,null,d)},a.format=function(a,c,d){var e=Utils.createCode(a,"Java: *scratched* code snippet",c),f={format:{source:e}};Calls.post(b,f,null,d)},a.multistageCode=function(a,c,d,e){var f=Utils.createCode(a,"Java: *scratched* code snippet",c),g={multistage:{source:f,budget:15,preprocess:d}};Calls.post(b,g,null,e)},a.getParticipants=function(a){Calls.get(c,null,a)},a.saveCodeSnippet=function(a,c){var d={persist:{source:a}};Calls.put(b,d,null,c)},a}(Refactoring||{}),Heuristics=function(a,b,c){"use strict";function d(a){return B.indexOf(a)>-1}function e(b){var c=(b.className+" "+(b.parentNode?b.parentNode.className:"")).split(/\s+/);return c=c.map(function(a){return a.replace(/^lang(uage)?-/,"")}),c.filter(function(b){return a.getLanguage(b)||"no-highlight"==b})[0]}function f(a){return["objective-c","cpp"].indexOf(a)>-1}function g(a){return["perl","prolog"].indexOf(a)>-1}function h(a){return["ecl","prolog"].indexOf(a)>-1}function i(a){return["typescript","xml"].indexOf(a)>-1}function j(a){return["common lisp","opencl"].indexOf(a)>-1}function k(a){return["rebol","r"].indexOf(a)>-1}function l(a){return["cs","java"].indexOf(a)>-1}function m(a){return["cpp","java"].indexOf(a)>-1}function n(a){return["c","java"].indexOf(a)>-1}function o(a){return["javascript","java"].indexOf(a)>-1}function p(a){return["cpp","cs"].indexOf(a)>-1}function q(a){var b=[];return a.indexOf("@interface")>-1&&b.push("objective-c"),(a.indexOf("#include <cstdint>")>-1||/include\\s*[<"]/.test(a)||/\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*</.test(a)||a.indexOf("::"))&&b.push("cpp"),b}function r(a){var b=[];return a.indexOf("use strict")>-1&&b.push("perl"),a.indexOf(":-")>-1&&b.push("prolog"),b}function s(a){var b=[];return a.indexOf(":=")>-1&&b.push("ecl"),a.indexOf(":-")>-1&&b.push("prolog"),b}function t(a){var b=[];return b.push(a.indexOf("</translation>")>-1?"xml":"typescript"),b}function u(a){var b=[];return a.indexOf("(defun ")>-1&&b.push("common lisp"),/\/\* |\/\/ |^\}/.test(a)&&b.push("opencl"),b}function v(a){var b=[];return/\bRebol\b/i.test(a)&&b.push("rebol"),a.indexOf("<-")>-1&&b.push("r"),b}function w(a){var b=[];return(a.indexOf("<summary>")>-1||a.indexOf("using System;")>-1||a.indexOf("typeof")>-1||a.indexOf("sizeof")>-1)&&b.push("cs"),a.indexOf("import")>-1&&b.push("java"),b}function x(a){var b=[];return(a.indexOf("#include <cstdint>")>-1||/#include\\s*[<"]/.test(a)||/\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*</.test(a)||a.indexOf("::"))&&b.push("cpp"),a.indexOf("import")>-1&&b.push("java"),b}function y(a){var b=[];return(a.indexOf("#include")>-1||/#include\\s*["]/.test(a))&&b.push("c"),a.indexOf("import")>-1&&b.push("java"),b}function z(a){var b=[];return(a.indexOf("!==")>-1||/\$[(.]/.test(a))&&b.push("javascript"),a.indexOf("import")>-1&&b.push("java"),b}function A(a){var b=[];return(a.indexOf("#include <cstdint>")>-1||/#include\\s*[<"]/.test(a)||/\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*</.test(a)||a.indexOf("::"))&&b.push("cpp"),(a.indexOf("<summary>")>-1||a.indexOf("using System;")>-1||a.indexOf("typeof")>-1||a.indexOf("sizeof")>-1)&&b.push("cs"),b}var B=["java"];return c.findByHeuristics=function(a,b){return b.every(f)?q(a):b.every(g)?r(a):b.every(h)?s(a):b.every(i)?t(a):b.every(j)?u(a):b.every(k)?v(a):b.every(l)?w(a):b.every(m)?x(a):b.every(n)?y(a):b.every(o)?z(a):b.every(p)?A(a):void 0},c.detect=function(b){var f=b.text(),g=e(b);if("no-highlight"==g)return"Unknown Language";var h=g?a.highlight(g,f,!0):a.highlightAuto(f);if(d(h.language))return h.language;var i="undefined"!=typeof h.second_best;if(i&&d(h.second_best.language))return h.second_best.language;var j=i?[h.language,h.second_best.language]:[h.language,"cs"],k=c.findByHeuristics(f,j);return k&&k.length>0?k[0]:"Unknown Language"},c}(window.hljs,window.jQuery,Heuristics||{}),Vesperize=function(a){"use strict";function b(a,b,c,d){a.buffers[b]=Editor.Doc(c,d)}function c(a,c,e){if(null!=c){if(a.buffers.hasOwnProperty(c))return void d(a,a.codemirror,c);b(a,c,e,"text/x-java"),d(a,a.codemirror,c)}}function d(a,b,c){var d=a.buffers[c],e=c!==p;b.setOption("readOnly",e),d.getEditor()&&(d=d.linkedDoc({sharedHist:!0}));var f=b.swapDoc(d),g=f.iterLinkedDocs(function(a){g=a});if(g){for(var h in a.buffers)a.buffers.hasOwnProperty(h)&&a.buffers[h]==f&&(a.buffers[h]=g);f.unlinkDoc(g)}b.focus()}function e(b,c,d){var e={};switch(b){case"error":e.title="Oh No",e.text=d+"!",e.type="error";break;case"notice":e.title="Watch out",e.text=d+"!",e.type="notice";break;case"info":e.title="Breaking News",e.text=d,e.type="info";break;case"success":e.title="Good News Everyone",e.text=d,e.type="success"}e.before_open=function(b){b.get().css({right:a(c.editor).width()/2-b.get().width()-10})},new PNotify(e),c.codemirror.focus()}function f(a,b,c){var d=Matcher.matchClassName(a,o)+".java";return d!==b?(c.classname=d,d):b}function g(a,b){null==a.buffers&&(a.persist(b),a.status.text("SAVED "))}function h(a,b){a.classname=f(b,a.classname,a),Refactoring.inspectWholeSourcecode(a.classname,b,function(b){var c=a.editor,d=i(b);d?c.hasClass("active")&&(c.removeClass("active"),c.addClass("broken")):c.hasClass("broken")&&(c.removeClass("broken"),c.addClass("active"))})}function i(a){return"undefined"!=typeof a.warnings&&a.warnings.length>0||"undefined"!=typeof a.failure}function j(b){b.fit();var c=b,d=Utils.debounce(function(){c.fit()},250,!1);a(window).on("resize",d),b.stopwatch=new Stopwatch}function k(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}function l(b,d){var e=b.multistage[b.id],f=e.stages,g=a.grep(f,function(a){return a.label===d});c(b,g[0].label,g[0].source.content)}function m(a){function b(a,b){return b=b.sort(function(b,c){return b[a].content.length>c[a].content.length})}e("info",a,"Entering multistage view"),a.buffers={},a.buffers[p]=a.codemirror.getDoc(),"undefined"==typeof a.multistage[a.id]&&a.codemirror.focus();for(var c=a.multistage[a.id],f=b("source",c.stages),g=f.length,h=0;g>h;h++){var i=f[h],j=h+" : "+i.label,k=i.label,m=a.namespace+"-"+k,n=Html.buildHtml("button",j,{type:"button",title:j,"class":"violette-button minibutton primary","data-provider":a.namespace,"data-handler":m,"data-stage":k});n.tooltipster({position:"bottom",theme:"tooltip-custom-theme"}),a.handler.push(m),a.callback.push(l),a.staging.append(n)}a.staging.append(Html.buildClosingButton(a)),a.handler.push(a.namespace+"-close"),a.callback.push(function(a){e("info",a,"Exiting multistage view"),a.staging.children().hide(),a.staging.children().remove(),a.staging.hide(),d(a,a.codemirror,p),a.buffers=null}),a.staging.show(),a.codemirror.focus()}function n(a,b){var c=a.codemirror,d=a.options.silent;if(b.draft){var e=b.draft.after;a.classname!==e.name&&(a.classname=e.name),c.setValue(e.content)}else if(b.info)console.log(b.info.messages.join("\n")),c.focus();else if(b.warnings)d?console.log(b.warnings.join("\n")):a.editor.hasClass("broken")||a.editor.addClass("broken");else if(b.stages)a.multistage[a.id]=b.stages,m(a);else if(b.stage)for(var f=b.stage,g=f.where,h=0;h<g.length;h++){var i=g[h],j=Utils.createLocation(c.getValue(),i[0],i[1]);a.codemirror.foldCode(Editor.Pos(j.from.line,j.from.col))}else{var k="There was an internal server error.",l=b.failure.message.indexOf(k)>-1,n=0==b.failure.message.length;l||n?"Invalid selection; unable to perform operation.":b.failure.message}c.focus()}var o="Scratched",p="Original",q={silent:!0,width:"inherit",height:"inherit",hideable:!1,intervalinmillis:5e3,actions:[{name:"delete",title:"Safely delete a selected code element.",icon:"octicon octicon-trashcan",callback:function(a){var b=a.codemirror,c=b.getValue();if(""!=c){var d=b.getSelection();if(""===d)e("notice",a,"There is nothing to delete");else if(d===c)e("notice",a,"There won't be any example left after this deletion");else{a.classname=f(c,a.classname,a);var g=Utils.selectionOffsets(b,c,d);Matcher.isComment(d)?(c=c.replace(d,""),Refactoring.format(a.classname,c,function(b){n(a,b)})):Refactoring.inspectWholeSourcecode(a.classname,c,function(b){var d=i(b);Refactoring.deleteSelection(a.classname,c,g,d,function(b){n(a,b)})})}}}},{name:"clip",title:"Clip a code selection",icon:"octicon octicon-clippy",callback:function(a){var b=a.codemirror,c=b.getValue();if(""!=c){var d=b.getSelection();if(""===d)e("notice",a,"There is nothing to delete");else if(Matcher.isMethod(d)){a.classname=f(c,a.classname,a);var g=Utils.selectionOffsets(b,c,d);Refactoring.inspectWholeSourcecode(a.classname,c,function(b){var d=i(b);Refactoring.clipSelectedBlock(a.classname,c,g,d,function(b){n(a,b)})})}else e("notice",a,"Only methods can be clipped. Please select one")}}},{name:"cleanup",title:"Code formatting plus deduplication",icon:"octicon octicon-three-bars",callback:function(a){var b=a.codemirror,c=b.getValue();""!=c&&(a.classname=f(c,a.classname,a),Refactoring.inspectWholeSourcecode(a.classname,c,function(b){var d=i(b);Refactoring.fullCleanup(a.classname,c,d,function(b){n(a,b)})}))}},{name:"rename",title:"Rename a selected element",icon:"octicon octicon-diff-renamed",callback:function(a,b){var c=a.codemirror,d=c.getValue(),g=c.getSelection();if(""!=d){""==g&&e("notice",a,"Please select something");var h=Utils.selectionOffsets(c,d,g);a.classname=f(d,a.classname,a),Refactoring.renameSelectedMember(a.classname,b,d,h,function(b){n(a,b)})}}},{name:"notes",title:"Annotates code sections",icon:"octicon octicon-comment",callback:function(){}},{name:"wrap",title:"Wrap code inside a class",icon:"octicon octicon-plus",callback:function(a,b){var c=a.codemirror,d=c.getValue(),g=c.getSelection();if(""!=d){""==g&&e("notice",a,"Please select something");var h=Utils.selectionOffsets(c,d,g);a.classname=f(d,a.classname,a),Refactoring.renameSelectedMember(a.classname,b,d,h,function(b){n(a,b)})}}},{name:"stage",title:"Multi stage code example",label:"Stage",callback:function(a){var b=a.codemirror,c=b.getValue();""!=c&&(a.classname=f(c,a.classname,a),Refactoring.inspectWholeSourcecode(a.classname,c,function(b){var d=i(b);Refactoring.multistageCode(a.classname,c,d,function(b){n(a,b)})}))}},{name:"history",title:"Show edit history",label:"History",callback:function(){}},{name:"full",title:"Launch fullscreen mode",label:"Fullscreen",callback:function(){}}],modes:[],social:[]},r=function(b,c){this.id=Utils.brand("violette"),this.namespace="violette-scratchspace",this.options=a.extend(!0,{},q,c),this.element=a(b),this.primaryKey=this.element.attr("data-scratcher-id"),this.handler=[],this.callback=[],this.classname=null,this.codemirror=null,this.editor=null,this.textarea=null,this.status=null,this.sloc=null,this.staging=null,this.content=null,this.multistage={},this.buffers=null,this.parent=this.element.parent("div.post-text"),this.context={dir1:"down",dir2:"left",context:this.parent},PNotify.prototype.options.styling="octicon",PNotify.prototype.options.delay=4e3,this.init(),this.stopwatch=new Stopwatch};return r.prototype.init=function(){var b=this;if(this.checkStorage(),null==this.editor){var c=Html.buildHtml("div",{id:this.id,"class":"violette-editor file",click:function(){b.focus()}},{});c.append(Html.buildHeader(this));var d=Html.buildHtml("textarea",b.content,{});c.append(Html.buildBody(this,d)),c.append(Html.buildFooter(this)),this.element.replaceWith(c),a.each(["height","width"],function(d,e){"inherit"!=b.options[e]&&(a.isNumeric(b.options[e])?c.css(e,b.options[e]+"px"):c.addClass(b.options[e]))}),this.editor=c,this.codemirror=Editor.fromTextArea(this.textarea[0],{lineNumbers:!0,styleActiveLine:!0,styleSelectedText:!0,theme:"default",mode:"text/x-java",viewportMargin:1/0,foldGutter:!0,matchBrackets:!0,extraKeys:{"Ctrl-Q":function(a){a.foldCode(a.getCursor())},"Ctrl-S":function(a){g(b,a.getValue()),h(b,a.getValue())}},undoDepth:1,gutters:["breakpoints","Editor-linenumbers","Editor-foldgutter"]});var e=13.45,f=a(this.textarea).val().split(/\r\n|\r|\n/).length;f=20>=f?20:f;var i=25>=f?f*e:(f+10)*e;this.codemirror.setSize("100%",i),this.codemirror.refresh(),this.editor.idleTimer(b.options.intervalinmillis),this.bindElements()}else this.editor.show();return j(this),this},r.prototype.bindElements=function(){this.editor.on("click",'[data-provider="violette-scratchspace"]',a.proxy(this.handleClickEvent,this)),this.codemirror.on("focus",a.proxy(this.focus,this)),this.codemirror.on("blur",a.proxy(this.blur,this));var b=this,c=Utils.debounce(function(){var a=b.codemirror.getValue();b.classname=f(a,b.classname,b),g(b,a)},250,!1);this.editor.on("idle.idleTimer",c),this.codemirror.on("beforeChange",function(){b.status.text("NOT SAVED ")});var d=Utils.debounce(function(){screenfull.isFullscreen?(b.exchange("fullscreen","octicon-screen-normal"),b.change("fullscreen",function(b){a(b).tooltipster("content","Exit fullscreen")})):(b.exchange("fullscreen","octicon-screen-full"),b.change("fullscreen",function(b){a(b).tooltipster("content","Enter fullscreen")}))},250,!1);this.editor.on(screenfull.raw.fullscreenchange,d)},r.prototype.checkStorage=function(){if(k()){var a=localStorage.getItem(this.primaryKey);return a?(this.content=a,this):null==this.content?(this.content=Utils.getContent(this,this.element),this):void 0}},r.prototype.handleClickEvent=function(b){var c=this,d=a(b.currentTarget),e=c.handler,f=c.callback,g=d.attr("data-handler"),h=e.indexOf(g),i=f[h];"undefined"==typeof d.attr("data-stage")?i(c):i(c,d.attr("data-stage")),b.preventDefault()},r.prototype.persist=function(a){return k()?(JSON.stringify(localStorage.getItem(this.primaryKey))!==JSON.stringify(a)&&(localStorage.setItem(this.primaryKey,a),this.content=null),this):this},r.prototype.change=function(b,c){var d=this,e=d.handler,f="all"==b;a.each(e,function(a,e){var g=f?!1:e.indexOf(b)<0;!g&&c&&c(d.editor.find('button[data-handler="'+e+'"]'))})},r.prototype.exchange=function(a,b){function c(a){var c=a.find("span.mega-octicon");c.length>=1&&(c.hasClass("octicon-screen-full")?(c.removeClass("octicon-screen-full"),c.addClass(b)):c.hasClass("octicon-screen-normal")&&(c.removeClass("octicon-screen-normal"),c.addClass(b)))}var d=this;d.change(a,c)},r.prototype.focus=function(){var b=this.editor;return b.addClass("active"),a(document).find(".violette-editor").each(function(){if(a(this).attr("id")!=b.attr("id")){var c=a(this).find("textarea").data("scratchspace");null==c&&(c=a(this).find('div[data-provider="violette-preview"]').data("scratchspace")),c&&c.blur()}}),this},r.prototype.blur=function(){var a=this.options,b=this.editor,c=a.hideable;return(b.hasClass("active")||0==this.element.parent().length)&&(b.removeClass("active"),c&&b.hide()),this},r.prototype.fit=function(){this.codemirror.refresh()},r}(window.jQuery);!function(a){"use strict";function b(a){a.attr("data-provide","violette-editable"),a.attr("data-savable","true")}function c(a,b){return new Vesperize(a,b)}function d(a){if(0!==a.find("pre").length)return!1;if(a.outerWidth()<100)return!1;var b=a.text().split("\n"),c=b.length;if(15>c)return!1;var d=["java","c","cpp","cs"],e=Heuristics.detect(a);return d.indexOf(e)>-1}function e(b,c){b.mouseenter(function(){var b=a(this).position(),d=a(this).outerWidth();c.css({position:"absolute",top:b.top+7+"px",left:b.left+d-45+"px"}).show(),c.show()}),b.mouseleave(function(){c.hide()}),c.mouseenter(function(b){a(this).show(),b.stopPropagation()}).mouseleave(function(){a(this).hide()})}function f(a){a.attr("title","Edit code"),a.tooltipster({position:"left",theme:"tooltip-custom-theme"})}function g(b){b.unbind("click").click(function(b){var c=a(this).attr("data-scratcher-id"),d=a("pre[data-scratcher-id='"+c+"']");j(d),b.preventDefault()})}var h=0,i=a.fn.scratchspace;a.fn.scratchspace=function(b){return this.each(function(){var d=a(this),e=d.attr("data-scratcher-id"),f=a("div[data-scratcher-id='"+e+"']");f.hide();var g=d.data("scratchspace"),h="object"==typeof b&&b;g||d.data("scratchspace",g=c(this,h))})},a.fn.scratchspace.noConflict=function(){return a.fn.scratchspace=i,this};var j=function(a){return a.data("scratchspace")?void a.data("scratchspace").init():void a.scratchspace(a.data())};a(document).on("click.scratchspace.data-api",'[data-provide="violette-editable"]',function(b){j(a(this)),b.preventDefault()}).ready(function(){a("pre").each(function(){var c=a(this);c.each(function(){var c=a(this);if(d(c)){var i=c.attr("data-provide"),j="undefined"!=typeof i&&i!==!1;if(!j){var k=a("<div/>",{"class":"scratch-button"}),l=a('<button class="violette-button octicon-danger"><span class="octicon octicon-pencil"></span></button>');k.append(l),k.attr("data-scratcher-id",h),c.attr("data-scratcher-id",h),b(c),h++,a("body").append(k),k.hide(),e(c,k),f(k),g(k)}}})})})}(window.jQuery);